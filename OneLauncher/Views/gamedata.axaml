<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="OneLauncher.Views.gamedata"
			 xmlns:vm="using:OneLauncher.Views.ViewModels"
			 xmlns:lo="clr-namespace:OneLauncher.Core.Helper.Models;assembly=OneLauncher.Core"
			 xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:ia="using:Avalonia.Xaml.Interactions.Core"
			 x:CompileBindings="True"
			 x:DataType="vm:GameDataPageViewModel">
	<i:Interaction.Behaviors>
		<ia:EventTriggerBehavior EventName="Loaded">
			<ia:InvokeCommandAction Command="{Binding PageLoadedCommand}" />
		</ia:EventTriggerBehavior>
	</i:Interaction.Behaviors>
	<SplitView IsPaneOpen="{Binding IsPaneShow,Mode=TwoWay}"
				 DisplayMode="Overlay"
				 OpenPaneLength="650"
				 PanePlacement="Right">
		<SplitView.Pane>
			<TransitioningContentControl Background="{DynamicResource PaneBackgound}" Content="{Binding PaneContent}"/>
		</SplitView.Pane>
		<Grid RowDefinitions="52,Auto,*" Margin="24">
			<StackPanel Margin="16,0,0,0" Orientation="Horizontal" Grid.Row="0" Spacing="28" >
				<TextBlock Grid.Row="0" Text="游戏数据管理器" FontSize="36"/>
				<Button Command="{Binding NewGameDataCommand}">
					<StackPanel Orientation="Horizontal">
						<Image Source="/Assets/icos/add.png" Width="20" Height="20"/>
						<TextBlock Text="新建"/>
					</StackPanel>
				</Button>
				<Button Margin="-14,0,0,0" Command="{Binding ImportCommand}">
					<StackPanel Orientation="Horizontal">
						<Image Source="/Assets/icos/download.png" Width="20" Height="20"/>
						<TextBlock Text="导入整合包"/>
					</StackPanel>
				</Button>
				<Button Margin="-14,0,0,0" Command="{Binding PowerPlayCommand}">
					<StackPanel Orientation="Horizontal">
						<Image Source="/Assets/icos/internet.png" Width="20" Height="20"/>
						<TextBlock Text="联机"/>
					</StackPanel>
				</Button>
				<Button Margin="-14,0,0,0">
					<StackPanel Orientation="Horizontal">
						<Image Source="/Assets/icos/settings1.png" Width="20" Height="20"/>
						<TextBlock Text="排序"/>
					</StackPanel>
					<Button.Flyout>
						<Flyout>
							<StackPanel>
								<Button Content="按时间排序（旧）"
										Command="{Binding SortingCommand}"
										CommandParameter="{x:Static lo:SortingType.AnTime_OldFront}"/>
								<Button Content="按时间排序（新）"
										Command="{Binding SortingCommand}"
										CommandParameter="{x:Static lo:SortingType.AnTime_NewFront}"/>
								<Button Content="按版本排序（旧）"
										Command="{Binding SortingCommand}"
										CommandParameter="{x:Static lo:SortingType.AnVersion_OldFront}"/>
								<Button Content="按版本排序（新）"
										Command="{Binding SortingCommand}"
										CommandParameter="{x:Static lo:SortingType.AnVersion_NewFront}"/>
							</StackPanel>
						</Flyout>
					</Button.Flyout>
				</Button>
			</StackPanel>
			<ListBox Grid.Row="2" ItemsSource="{Binding GameDataList}" Background="Transparent" SelectionMode="Multiple">
				<ListBox.ItemTemplate>
					<DataTemplate x:DataType="vm:GameDataItem">
						<Border CornerRadius="5">
							<Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
								<Border Grid.Column="0" CornerRadius="6" ClipToBounds="True">
									<Image Width="64" Height="64" Source="{Binding Icon}"/>
								</Border>
								<StackPanel Grid.Column="1" Margin="15,0" VerticalAlignment="Center">
									<TextBlock FontSize="18" FontWeight="SemiBold" Text="{Binding data.Name}"/>

									<StackPanel Orientation="Horizontal" Spacing="10" Margin="0,5,0,0">
										<TextBlock FontSize="12" Foreground="Gray">
											<Run Text="版本:"/>
											<Run Text="{Binding data.VersionId}"/>
										</TextBlock>
										<TextBlock FontSize="12" Foreground="Gray">
											<Run Text="加载器:"/>
											<Run Text="{Binding data.ModLoader}"/>
										</TextBlock>
									</StackPanel>
								</StackPanel>

								<StackPanel Grid.Column="2" Spacing="8" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="6">

									<Border IsVisible="{Binding IsDefault}"
											Background="#FFFBE5" CornerRadius="4" Padding="8,4" VerticalAlignment="Center">
										<TextBlock Text="默认" FontWeight="Bold" Foreground="#D4AC0D" FontSize="12"/>
									</Border>

									<Button IsVisible="{Binding !IsDefault}"
											Command="{Binding $parent[UserControl].DataContext.SetAsDefaultInstanceCommand}"
											CommandParameter="{Binding data}">
										<StackPanel Orientation="Horizontal" Spacing="6">
											<Image Source="/Assets/icos/pin.png" Width="16" Height="16"/>
											<TextBlock Text="设为默认"/>
										</StackPanel>
									</Button>

									<Button Command="{Binding $parent[UserControl].DataContext.ShowEditPaneCommand}" CommandParameter="{Binding data}">
										<StackPanel Orientation="Horizontal" Spacing="6">
											<Image Source="/Assets/icos/edit.png" Width="16" Height="16"/>
											<TextBlock Text="编辑"/>
										</StackPanel>
									</Button>
									<SplitButton Classes="Accent" Command="{Binding LaunchCommand}" CommandParameter="{Binding data}">
										<StackPanel Orientation="Horizontal" Spacing="6">
											<Image Source="/Assets/icos/launch.png" Width="16" Height="16"/>
											<TextBlock Text="启动"/>
										</StackPanel>
										<SplitButton.Flyout>
											<Flyout>
												<CheckBox IsChecked="{Binding IsUseDebugModLaunch}" Content="调试模式启动"/>
											</Flyout>
										</SplitButton.Flyout>
									</SplitButton>
								</StackPanel>
							</Grid>
						</Border>
					</DataTemplate>
				</ListBox.ItemTemplate>
				<ListBox.Styles>
					<Style Selector="ListBoxItem">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="Padding" Value="5"/>
						<Setter Property="Transitions">
							<Transitions>
								<BrushTransition Property="Background" Duration="0:0:0.23"/>
								<BrushTransition Property="Background" Duration="0:0:0.3" Easing="QuadraticEaseInOut"/>
							</Transitions>
						</Setter>
					</Style>
					<Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="Opacity" Value="0.95"/>
						<Setter Property="RenderTransform">
							<ScaleTransform ScaleX="1.02" ScaleY="1.02"/>
						</Setter>
					</Style>
					<Style Selector="ListBoxItem:pressed /template/ ContentPresenter">
						<Setter Property="Background" Value="Transparent"/>
					</Style>
					<Style Selector="ListBoxItem:selected /template/ ContentPresenter">
						<Setter Property="Background" Value="Transparent"/>
					</Style>
					<!-- 阴影样式 -->
					<Style Selector="ListBoxItem > Border">
						<Setter Property="ClipToBounds" Value="False"/>
						<Setter Property="Margin" Value="4"/>
						<Setter Property="BoxShadow" Value="0 0 4 1 #22000000"/>
						<Setter Property="Background" Value="{DynamicResource ListBoxItemBackgound}" />
					</Style>
					<Style Selector="ListBoxItem:pointerover > Border">
						<Setter Property="BoxShadow" Value="2 2 8 2 #33000000"/>
					</Style>
					<Style Selector="ListBoxItem:pressed > Border">
						<Setter Property="BoxShadow" Value="1 1 4 1 #22000000"/>
					</Style>
					<!-- 确保内容不被裁剪 -->
					<Style Selector="ListBoxItem > Border">
						<Setter Property="ClipToBounds" Value="False"/>
						<Setter Property="Margin" Value="10"/>
					</Style>
				</ListBox.Styles>
			</ListBox>
		</Grid>
	</SplitView>
</UserControl>
